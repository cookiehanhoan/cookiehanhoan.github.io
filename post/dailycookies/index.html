<!doctype html><html lang=en><head><title>DailyCookies &ndash; CookieHanHoan Security Blog</title><meta name=description content="Blog về bảo mật - Cookie Han Hoan"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://cookiehanhoan.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://cookiehanhoan.github.io/css/risotto.css><link rel=stylesheet href=https://cookiehanhoan.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://cookiehanhoan.github.io/ class=page__logo-inner>CookieHanHoan Security Blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=https://cookiehanhoan.github.io/about/ title>About</a></li><li class=main-nav__item><a class=nav-main-item href=https://cookiehanhoan.github.io/homepage/ title=Homepages>Homepages</a></li><li class=main-nav__item><a class="nav-main-item active" href=https://cookiehanhoan.github.io/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>DailyCookies</h1></header><div class=content__body><h1 id=daily-cookies>Daily cookies</h1><p>pdf printing solution</p><p><a href=https://www.browserless.io/pricing/>Pricing - Browserless</a></p><p><a href=https://blog.checklyhq.com/puppeteer-vs-selenium-vs-playwright-speed-comparison/>Puppeteer vs Selenium vs Playwright, a speed comparison</a></p><p><a href=https://github.com/mileszs/wicked_pdf>https://github.com/mileszs/wicked_pdf</a></p><p><a href=https://github.com/transitive-bullshit/awesome-puppeteer>https://github.com/transitive-bullshit/awesome-puppeteer</a></p><p><a href=https://docraptor.com/documentation>How to convert HTML-to-PDF with Other Documentation - DocRaptor HTML to PDF Converter</a></p><h2 id=02-01-2023>02-01-2023</h2><h3 id=external-dns-across-k8s-clusters>External DNS across K8S clusters</h3><ul><li><p>when installing External DNS (X-DNS) across clusters to manage same DNS zone(s)</p><ul><li>pay attention to your <code>owner</code> setting</li></ul><p><a href=https://github.com/kubernetes-sigs/external-dns/blob/d4523be44ce53069fa8371527a4f297fd1af94a1/pkg/apis/externaldns/types.go#L244>external-dns/types.go at d4523be44ce53069fa8371527a4f297fd1af94a1 · kubernetes-sigs/external-dns</a></p><ul><li>otherwise, all of your DNS (managed by X-DNS) in other cluster will be <strong>gone</strong> 🙂</li></ul></li><li><p>reason: X-DNS using TXT to manage DNS records</p><ul><li>e.g. <code>"heritage=external-dns,external-dns/owner=default,external-dns/resource=ingress/default/baby-php-type-juggling-inarray-111-ingress"</code></li></ul></li><li><p>by default, <code>external-dns/owner</code> is set to <code>default</code></p><ul><li>if you leave it as-is, it will be same across clusters → DNS records will be override according to ingress / service deployed in a cluster</li></ul></li></ul><h2 id=07-11-2022>07-11-2022</h2><h3 id=database-change-process>Database change process</h3><ul><li>pre-check<ul><li>table size</li><li>critical?</li><li>current traffic</li><li>lock table or not</li></ul></li><li>if critical + high traffic<ul><li><strong>backup</strong></li><li>tern on maintanence mode → prevent unexpected write</li><li>run query</li></ul></li></ul><h2 id=23-07-2022>23-07-2022</h2><h3 id=linux-shm-tmpfs>Linux SHM (tmpfs)</h3><ul><li>shared memory, backed by memory <strong>and swap</strong></li><li>means of passing data between programs</li><li><code>tmpfs</code> appears as a mounted files system, but data located in memory<ul><li>provide file system interface <del>with good performance</del></li></ul></li></ul><blockquote><p><code>tmpfs</code> performance is deceptive. You will find workloads that are faster on tmpfs, and this is <em>not</em> because RAM is faster than disk: All filesystems are cached in RAM – the page cache! Rather, it is a sign that the workload is doing something that defeats the page cache. And of the worse things a process can do in this regard is syncing to disk way more often than necessary.</p></blockquote><p><a href=https://superuser.com/questions/45342/when-should-i-use-dev-shm-and-when-should-i-use-tmp>When should I use /dev/shm/ and when should I use /tmp/?</a></p><ul><li>the perfomance point is deceptive because<ul><li>write to fs doesn’t necessarily slower than to memory</li><li>whole fs is cached (buffer)<ul><li>write is async until call <code>fsync()</code></li><li>the only time that program notice the read speed</li></ul></li><li>if your process is I/O bound → use tmpfs for better performance</li></ul></li></ul><h2 id=12-07-2022>12-07-2022</h2><h3 id=gitlab---repo-checks>Gitlab - repo checks</h3><h3 id=elasticsearch-realm>Elasticsearch realm</h3><ul><li>quick note on <strong>authentication process</strong>:<ul><li>after authentication is completed, username (maybe also role name) will be added to sub-requests → for authorization</li></ul></li><li>core of authentication process</li><li>use to distinguish user authentication by the means<ul><li>e.g. LDAP, Kerberos, Reserved, <strong>Native</strong>, <strong>File</strong></li></ul></li><li>commonly used Realm<ul><li><code>reserverd</code>: for internal user auth - Kibana, Beats</li><li><code>native</code>: store hash of user password in <code>.security</code> index</li><li><code>file</code>: same like native, but store hashed password in file<ul><li><strong>tips:</strong> this has practical use - in case <code>.security</code> index or external services (LDAP, Kerberos) become unavailable, <strong>only user with <code>file</code> realm can authenticate with ES</strong></li></ul></li></ul></li></ul><h2 id=20-06-2022>20-06-2022</h2><h3 id=fastapi-return-307-redirect>FastAPI return 307 redirect</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>app<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#34;/v2/api-key/&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#39;https://cvparser-core.rework.vn/v2/api-key&#39;</span> -X POST -H <span style=color:#e6db74>&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:101.0) Gecko/20100101 Firefox/101.0&#39;</span> -H <span style=color:#e6db74>&#39;Accept: application/json, text/plain, */*&#39;</span> -H <span style=color:#e6db74>&#39;Accept-Language: vi-VN,vi;q=0.8,en-US;q=0.5,en;q=0.3&#39;</span> -H <span style=color:#e6db74>&#39;Accept-Encoding: gzip, deflate, br&#39;</span> -H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> -H <span style=color:#e6db74>&#39;Authorization: Bearer ${Bearer}&#39;</span> -H <span style=color:#e6db74>&#39;Origin: https://cvparser-admin.rework.vn&#39;</span> -H <span style=color:#e6db74>&#39;Connection: keep-alive&#39;</span> -H <span style=color:#e6db74>&#39;Referer: https://cvparser-admin.rework.vn/&#39;</span> -H <span style=color:#e6db74>&#39;Sec-Fetch-Dest: empty&#39;</span> -H <span style=color:#e6db74>&#39;Sec-Fetch-Mode: cors&#39;</span> -H <span style=color:#e6db74>&#39;Sec-Fetch-Site: same-site&#39;</span> -H <span style=color:#e6db74>&#39;TE: trailers&#39;</span> --data-raw <span style=color:#e6db74>&#39;{&#34;key&#34;:&#34;wqr-1655742521358-ee1aae49-0048-4ac6-be14-fc691050aa75&#34;,&#34;limit&#34;:5}&#39;</span>
</span></span></code></pre></div><ul><li>note the <code>/</code> at the end of route<ul><li><strong>pain</strong></li></ul></li></ul><h2 id=19-06-2022>19-06-2022</h2><h3 id=https-path-is-encrypted>HTTPs path is encrypted</h3><ul><li><strong>The URL path and query string parameters are encrypted</strong>, as are POST bodies.</li><li>however, we still shouldn’t put credentials in HTTPS path<ul><li>it is logged in browser history</li><li>be seen by someone glancing at the screen</li><li>can be leak by SNI</li></ul></li></ul><h2 id=18-06-2022>18-06-2022</h2><h3 id=dns---mx-record-priority>DNS - MX record priority</h3><ul><li>increase P of mail delivery</li><li>when client query mail server<ul><li>return list of mail servers</li><li>try the one with highest priority</li><li>if it doesn’t make it</li><li>try the next one</li></ul></li></ul><h3 id=ptr-records>PTR records</h3><ul><li>use for reverse DNS lookup<ul><li>from IP → get domain</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dig -x 1.1.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; -x 1.1.1.1
</span></span><span style=display:flex><span>;; global options: +cmd
</span></span><span style=display:flex><span>;; Got answer:
</span></span><span style=display:flex><span>;; -&gt;&gt;HEADER<span style=color:#e6db74>&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span style=color:#ae81ff>64277</span>
</span></span><span style=display:flex><span>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>;; OPT PSEUDOSECTION:
</span></span><span style=display:flex><span>; EDNS: version: 0, flags:; udp: <span style=color:#ae81ff>1232</span>
</span></span><span style=display:flex><span>;; QUESTION SECTION:
</span></span><span style=display:flex><span>;1.1.1.1.in-addr.arpa.		IN	PTR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>;; ANSWER SECTION:
</span></span><span style=display:flex><span>1.1.1.1.in-addr.arpa.	263	IN	PTR	one.one.one.one.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>;; Query time: <span style=color:#ae81ff>10</span> msec
</span></span><span style=display:flex><span>;; SERVER: 192.168.1.1#53<span style=color:#f92672>(</span>192.168.1.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>;; WHEN: Sat Jun <span style=color:#ae81ff>18</span> 00:30:44 +07 <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span>;; MSG SIZE  rcvd: <span style=color:#ae81ff>78</span>
</span></span></code></pre></div><ul><li>can be used to detect spam<ul><li>receive different header/email from single server</li></ul></li></ul><blockquote><p><strong>Logging:</strong> System logs typically record only IP
addresses; a reverse DNS lookup can convert these into domain names for
logs that are more human-readable.</p></blockquote><p>Along with this: Don&rsquo;t alert on CPU/Mem/Network. Those are false flags. Alert on pending pods. Alert on deployments that are stalled. Alert on your service health metrics. Leave the management of machines to your platform vendor, and use those in diagnosis of problems with your service, but &ldquo;node has high CPU usage&rdquo; is not a problem. &ldquo;My service is slow&rdquo; is a problem - And a potential cause of that problem is high CPU usage on a node, but high cpu usage isn&rsquo;t the thing you care about.</p><p>Generally #2, install kube-state-metrics and monitor with prometheus. kube-state-metrics doesn&rsquo;t use events to make inferences about the state of the system.</p><p>Events are more of a &rsquo;nice to have&rsquo;, one of the core principles of Kubernetes is that events should not be actionable, i.e. you wouldn&rsquo;t respond or have an operator/controller taking actions based on events. They are really only &lsquo;hints&rsquo; to the people trying to reason about what the state of the system is.</p><p>Logs are the same, they should never be actionable. Metrics should tell you what the current state of the system is, logs are there for analysis to understand why it was in that state</p><h2 id=05-05-2022>05-05-2022</h2><h3 id=k8s-secrets>K8S secrets</h3><ul><li>by default store unencrypted in <code>etcd</code></li><li>similar to <code>configmap</code>, except used for credentials (seperate for RBAC convenience)<ul><li><em>note on RBAC</em>: anyone has permission to create pods <strong>implicitly</strong> has permisson to read k8s secrets</li></ul></li><li>maximum size of single secret: <strong>1 MB</strong></li><li></li></ul><h2 id=09-04-2022>09-04-2022</h2><h3 id=ssl-handshake-explained-again->SSL Handshake explained (again 😎)</h3><ul><li><p>Overview:</p><ul><li>client and server exchange <code>public_key</code> and agree on a common <code>session_key</code> to encrypt/decrypt data</li><li>ensure who ís who</li></ul></li><li><p>Concepts</p><ul><li>SSL Cert: contain <code>server_public_key</code> and <code>server_info</code>, signed by a CA or self-signed</li></ul></li><li><p>Steps</p><ul><li>TCP Handshake</li><li>ClientHello (supported protocol version, cipher, etc.)</li><li>ServerHello, Cert, ServHelloDone<ul><li>Cert: SSL Cert</li><li>on_receive: verify cert come from server (using CA public keys)</li></ul></li><li>ClientKeyExchange<ul><li>send <code>premaster</code> (random string) to server</li><li>server use client <code>premaster</code> secret to generate session key</li></ul></li></ul><blockquote><p>All TLS handshakes make use of asymmetric encryption (the public and private key), but not all will use the private key in the process of generating session keys</p></blockquote><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled.png alt=Untitled></p></li></ul><h2 id=29-03-2022>29-03-2022</h2><h3 id=nginx-ingres-affinity>Nginx ingres affinity</h3><ul><li>mode:<ul><li><code>persistent</code>: maximum persistency - not redistribute session when scaling happens</li><li><code>balanced</code>: >&lt; with <code>persistent</code></li></ul></li><li>affinity session: only support <code>cookie</code><ul><li>e.g. <code>INGRESSCOOKIE: "d7e757e232c266bde814567294e75d4f"</code></li></ul></li></ul><h2 id=17-03-2022>17-03-2022</h2><h3 id=lambda-cold-start>Lambda cold start</h3><ul><li>lambda cold start doesn’t really matter if you run background job<ul><li>1xx ms → 1s</li></ul></li><li>it may add up your delay if you serve API<ul><li>but rarely happen with prod workload, bc requests keep lambda warm<ul><li>except when it’s scaling or when you deploy new code</li></ul></li></ul></li><li>AWS has a feature to help improve lambda perf called <a href=https://docs.aws.amazon.com/lambda/latest/dg/provisioned-concurrency.html>provisioned concurrency</a><ul><li>yeah but it makes lambda less sexy (pricing issue)</li></ul></li></ul><h3 id=interview-lession-learned>Interview lession learned</h3><ul><li>if you don’t know, admit that you don’t know → it’s much harder than you think !</li><li>try to ask interviewer about his opinion / solution (if he is willing to answer)</li></ul><hr><h1 id=archived>Archived</h1><p>18/03/2020</p><ul><li><p>process model based on:</p><ul><li>resource grouping: group (separate) related resource<ul><li>program text,</li><li>opening files</li><li>signals/signal handlers</li></ul></li><li>thread of execution:<ul><li>share process&rsquo; resources</li><li>have their own resource to separate them<ul><li>PC</li><li>register</li></ul></li></ul></li></ul></li><li><p>preempt: thread scheduling is managed by OS</p></li><li><p><code>asyncio</code> use cooperative multi tasking</p><ul><li>user can make decision when/where ready to switch</li></ul></li><li><p>IO-bound</p><ul><li>spend most of it&rsquo;s time doing IO operations</li><li>usually wait for external resource<ul><li>esp. something much slower than CPU</li></ul></li><li><em>speed up</em>: overlapping the waiting for devices</li></ul></li><li><p>CPU-bound</p><ul><li>spend most of it&rsquo;s time doing computation</li><li>intensive computation, not read/write data from/to file, net,&mldr;</li><li><em>speed up</em>: do more computation at one time</li></ul></li><li><p>ThreadPoolExecutor = thread + pool + executor</p><ul><li>manage thread if you don&rsquo;t need fine-grained control</li></ul></li><li><p>share data</p><ul><li>must be thread-safe for data access<ul><li>depend on how/when access data,&mldr;</li><li>queue</li></ul></li></ul></li><li><p><code>asyncio</code></p><ul><li><p>core concept:</p><ul><li>event-loop</li><li>list maintaining state,&mldr; e.g. [ready, waiting]</li></ul></li><li><p>never get interrupted without intentionally do it (giving control to control)</p><ul><li>no worry thread-safe</li></ul></li><li><p>coroutine vs subroutine</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Co-routine is sub-routine but persistent
</span></span></code></pre></div><ul><li>subroutine stack bound to calling stack</li><li>coroutine stack separate (can resume/pause by any calling having access to it)</li></ul></li></ul></li></ul><p>19/03/2020</p><p>terraform</p><ul><li><p>declarative (specified what the desired states)</p></li><li><p>client-only architecture</p></li><li><p>cannot rollback</p></li><li><p>should use implicit dependency</p></li><li><p><code>provisioner</code> is run only when resource is <em>created</em></p><p>⇒ not replace configuration management</p></li><li><p><code>exec plan</code>: do exactly what it has told</p><ul><li>tainted resource (provisioner failed) ⇒ not auto destroy tainted when apply the first time<ul><li>doing so against exec plan</li><li>next time ⇒ destroy instance ⇒ exec provisioner</li></ul></li></ul></li><li><p>provisioner are the last resort</p><ul><li>use alternative wherever possible</li></ul></li></ul><p>22/03/2020</p><p>python concurrency</p><ul><li>concurrency = (multiprocessing<para>, multithreading,</li></ul><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%201.png alt=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%201.png></p><ul><li><p>coroutines:</p><ul><li>have multi endpoint to start, resume function<ul><li><em>diff</em> with <code>generator</code>: generator generate data, <code>coroutine</code> can consume data</li></ul></li></ul></li><li><p>asyncio: the Python package that provides a foundation and API for running and managing coroutines</p></li><li><p>Async IO:</p><ul><li>single threaded, single process design</li><li><strong>cooperative multitasking</strong></li></ul></li><li><p>why parameterized SQL query can prevent <code>sql injection</code>?</p><ul><li>its not execute the query directly (give to special procedure&mldr;)</li><li>treat params as data (not query as when executed directly)</li></ul></li></ul><p>Web security</p><ul><li>when get untrusted input from someone ⇒ analyze carefully<ul><li><code>content standardization</code></li></ul></li></ul><p>24/03/2020</p><ul><li><strong>exp</strong> to debug python error in exception block, use <code>raise</code>, not <code>print</code></li></ul><p>25/03/2020</p><p>SMTP</p><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%202.png alt=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%202.png></p><ul><li>SMTP user to <em>send</em> email (push model)<ul><li>POP3(pull) / IMAP ⇒ <em>receive</em> email</li></ul></li><li>User agent: Outlook, Mozilla,&mldr;</li></ul><p>26/03/2020</p><p>terraform</p><ul><li>use <code>data</code> source to read and query data</li><li>use <code>lifecycle</code> hook ⇒ <code>create_before_destroy</code></li><li>use <code>provisioner</code> to perform healthcheck,&mldr;.</li></ul><p>python concurrency</p><ul><li>other languages had (multiple) ways to approach threading concurrency</li><li>python: GIL ⇒ threads cannot run parallel in multi core<ul><li>perf affacted when need to utilize threads on multiple core</li></ul></li></ul><p>aws</p><ul><li>separate env by account (dev,staging,prod)<ul><li>prod ⇒ mirror staging:</li><li>staging need to have &ldquo;real&rdquo; data (no need to large but <em>real</em>)</li><li>code need to hitting staging often ⇒ tested every sprints,&mldr;</li></ul></li><li>can use DNS as a service discovery<ul><li>do not need agent, dependency,..</li><li>must somehow register service to registry (client or server side)</li></ul></li><li>cloud map (aws) service discovery<ul><li>can map instance ⇒ service</li><li>ez to integrate with other aws service</li><li>query by dns, attribute,&mldr;</li><li>provide health check&mldr;</li></ul></li></ul><p><a href=https://segment.com/blog/the-million-dollar-eng-problem/>https://segment.com/blog/the-million-dollar-eng-problem/</a></p><p>millions $ lession</p><ul><li><p>dynamodb ⇒ hosted version of Cassandra, support 2nd index, abstract replication, partition</p><ul><li>pricing model works in terms of throughput</li><li>same key ⇒ same server, same partition</li><li>should uniformly distribute read/write<ul><li>void 1 server constantly overload, other idle</li></ul></li></ul><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%203.png alt=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%203.png></p><ul><li>dictates the number of partitions rather than the total throughput.</li><li>h</li></ul></li></ul><p>PGP</p><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%204.png alt="pgp encryption"></p><p>pgp encryption</p><p><img src=Daily%20cookies%20bb785df24fca4563ba9a19541fd2c647/Untitled%205.png alt="pgp decryption"></p><p>pgp decryption</p><ul><li>speed of conventional key encrypt (use <code>session key</code> to encrypt data)</li><li>convenience of public key distribution</li></ul><p>Digital sig:</p><ul><li>RSA: instead of encrypt data using other people pub key<ul><li>use your own priv key ⇒ if people can decrypt it using your pub ⇒ it&rsquo;s your content</li></ul></li><li>that may double size your data<ul><li>use hash function</li><li>PGP: digest(hashed plain) + private key ⇒ signature<ul><li>send sig + plaintext</li><li>decrypt sig using pub key</li><li><strong>TODO</strong></li></ul></li></ul></li></ul><p>27/03/2020:</p><p>python decorator</p><ul><li>without args ⇒ <code>func = decor(func)</code><ul><li>decor need to return a <em>wrapper</em> of func</li></ul></li><li>with args ⇒ <code>func = decor(*args*,***kwargs)(func)</code><ul><li>decor need to return a function that <code>func</code> is a input ⇒ return <em>wrapper</em> of func</li></ul></li><li><code>functools.wraps(f)</code> helps preserve information of the origin function (not wrapper)</li><li>can be useful when debug (print args, return whenever a function is call)<ul><li><em>esp.</em> helpful when we don&rsquo;t directly call the function need to be debugged ourselves</li><li><em>e.g</em>: <em>recursive</em></li></ul></li><li>can use to throttle request (slow down func)</li><li>it doesn&rsquo;t have to wrap function<ul><li><em>register</em> an existing function ⇒ return it unwrapped</li></ul></li></ul><p>30/03/2020:</p><p>flask design decision</p><ul><li>explicit application object<ul><li>fake multiple applications ⇒ unit testing,&mldr;</li><li>can create subclass<ul><li>it not easy if the app object is created ahead of time</li></ul></li><li>can init flask with the package <strong><code>name</code></strong><ul><li>use to access other resource relative to the package (templates,..)</li><li>can use CWD ⇒ not reliable (cuz it&rsquo;s process-wide)</li></ul></li><li><code>explicit is better than implicit</code></li></ul></li><li>micro framework</li><li>thread locals<ul><li>uses thread local objects for session, extra object,&mldr;</li><li>harder to maintain for large application</li><li>flask aims for small traditional web app</li><li></li></ul></li></ul><p>samesite cookie</p><ul><li>def:<ul><li>user enter <code>A.com</code></li><li><code>[A.com](http://a.com)</code> contains a cat picture which hosted on <code>B.com</code></li><li>cookies of in browser for <code>[B.com](http://b.com)</code> would be sent to <code>B.com</code><ul><li><a href=http://b.com>B.com</a> maybe <code>vpbank.com/reset_password</code></li></ul></li></ul></li><li>it&rsquo;s dangerous but we still need it in other situation:<ul><li>page ref to fb, google,..</li><li>ads,&mldr;</li></ul></li><li>SameSite<ul><li>Strict: never send cross-site</li><li>Lax: send when user follow link, (click,&mldr;) - GET request<ul><li>SameSite must be Secure</li></ul></li></ul></li></ul><p>best practice to learn React</p><ul><li><a href=https://www.reddit.com/r/reactjs/comments/a8c0yp/what_is_the_best_way_to_learn_react/>https://www.reddit.com/r/reactjs/comments/a8c0yp/what_is_the_best_way_to_learn_react/</a></li><li>That example LoginForm component is likely passed a callback as a prop that it will call when the login is successful, probably passing that callback the username and/or any profile information. This can sound complex, but it isn&rsquo;t really - LoginForm ends up &ldquo;dumb&rdquo;, because it doesn&rsquo;t know anything about the app. It knows how to login, and is given a callback to call once it has done so. &ldquo;Dumb&rdquo; (decoupled) means the opposite of complexity.</li><li>thinking about how the UI should look at any given moment, rather than how to change it over time, eliminates a whole class of bugs.</li><li>All React components must act like pure functions with respect to their props.</li></ul><p>03/04/2020</p><p><strong>[exp]</strong> evidence-based software engineering</p><ul><li>empirical</li><li>what technology is appropriate in <em>specific situation</em></li><li><code>asking the right question</code><ul><li>&ldquo;is pair programming useful?&rdquo; ⇒ not detail</li><li>&ldquo;Does PP lead to improved code quality when practiced by professional dev?&rdquo; ⇒ detailed<ul><li>what intervention (PP)</li><li>what population</li></ul></li></ul></li></ul><p>09/04/2020</p><p><strong>[exp]</strong> aws iam policy can be error without notification</p><ul><li>conditions contain invalid keys</li></ul><p>14/04/2020</p><p><strong>[exp]</strong> presentation</p><ul><li>who is targeted attendee<ul><li>end users need diff information from developers</li></ul></li></ul><p>21/04/2020</p><p><strong>[exp]</strong> arch</p><ul><li>should go from and focus on business viewpoint first<ul><li>where/how you got that desired CCU</li></ul></li><li>based on understanding of business<ul><li>what scenarios(flow) cause what bottlenecks<ul><li>it may not relevant to what customer thinks about their problem</li><li>what had customer done to figure out their problem<ul><li>is there anything wrong with it<ul><li>the way they&rsquo;re doing test,&mldr;</li></ul></li></ul></li></ul></li><li>technology used<ul><li>even &ldquo;hype&rdquo; techstack has its own problem</li></ul></li><li>ops or dev need to be improved<ul><li>external connection (port),&mldr;</li></ul></li></ul></li></ul><p>26/04/2020</p><p>service-oriented architecture and merging services</p><ul><li>does separating services benefit from separated service over performance issue (hopped network,&mldr;)<ul><li>e.g scalability can be addressed only in one service</li><li>maintain security in standalone service</li></ul></li><li>how to implement new arch<ul><li>if both services provide REST ⇒ can embed one service as the other&rsquo;s local library</li><li>A/B testing (ramp up)</li><li>perf analysis<ul><li>dark canary<ul><li>replicate, multiply real read-only prod traffic ⇒ test hosts</li></ul></li><li><a href=https://sematext.com/blog/java-garbage-collection-logs/>https://sematext.com/blog/java-garbage-collection-logs/</a></li></ul></li></ul></li></ul><p><a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding?utm_campaign=Grokking%20Newsletter&utm_medium=email&utm_source=Revue%20newsletter">https://www.digitalocean.com/community/tutorials/understanding-database-sharding?utm_campaign=Grokking Newsletter&utm_medium=email&utm_source=Revue newsletter</a></p><p>30/04/2020</p><p>github workflow</p><ul><li>can have multiple workflows in a repo</li><li>triggering<ul><li>can be scheduled (POSIX)</li><li>triggered by event (i.e. webhook event)<ul><li>e.g create new branch, delete,&mldr;</li><li>issue is solved, reopened ,&mldr;</li><li>external event ⇒ send POST to github API</li></ul></li></ul></li><li>workflow only triggered when use <code>personal token</code><ul><li>not by GITHUB Token ⇒ avoid recursive trigger<ul><li>e.g. workflow run and make some event (push code,.._)</li></ul></li></ul></li><li>can filtered by branches, tags and <em>paths</em></li><li>can use build matrix to test code across platform, OS, lang ver</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>${{ matrix.os }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>matrix</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>os</span>: [<span style=color:#ae81ff>ubuntu-16.04, ubuntu-18.04]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>node</span>: [<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>10</span>]
</span></span></code></pre></div><ul><li><p>reference to actions</p><ul><li>can be in pub repo (or DockerHub)</li><li>if ref → private repo ⇒ workflow and action must be in same repo</li><li>use <code>check runs</code> to add status information to a commit</li></ul><p><a href=https://dev.to/gr2m/github-api-how-to-retrieve-the-combined-pull-request-status-from-commit-statuses-check-runs-and-github-action-results-2cen>GitHub API: How to retrieve the combined pull request status from commit statuses, check runs, and GitHub Action results</a></p><ul><li><code>check runs</code> can be used to add more than binary (PASS/FAIL) information ⇒ can add context, additional information<ul><li><strong>[exp]</strong> use when have external CI tool</li></ul></li></ul></li></ul><p>a project can have more than one CI tool when:</p><ul><li><p>developed by two or more separated teams</p></li><li><p>team A trigger team B CI (by put status, hook,&mldr;)</p></li><li><p>use minimum permission key. E.g:</p><ul><li>when deploy app to deployment server ⇒ use <em>deploy keys</em> instead of personal secret<ul><li>PK is attached to repo, not personal account each user</li></ul></li></ul><p><code>Avoid passing secrets between processes from the command line, whenever possible</code></p><ul><li>can be visible via <code>ps</code> command or captured by <code>security audit</code> event</li></ul></li><li><p>secret limit</p><ul><li>can have up to 100 secrets</li><li>≤ 64KB in size<ul><li>if larger than that: store encrypted secret in repo, save decryption passphrase at secret on Githu</li></ul></li></ul></li><li><p>artifact: share data btw jobs and save data after workflow completed</p></li><li><p>github currently not have Rest API for upload/download artifact to use btw jobs</p><ul><li>use S3 or other storage</li></ul></li><li><p>cache</p><ul><li>use for github-hosted runner</li><li>do not store secret in cache<ul><li>anyone with Read perm can create PR and read cache content</li></ul></li><li>can access the cache in workflow triggered by <code>pull_request</code> or <code>push</code> , except for <code>pull_request</code> <code>closed</code></li><li>workflow can access cache in current branch, the base branch, and default branch</li><li>only retent in 7 days and up to 5GB</li></ul></li><li><p>service container</p><ul><li><p>when need to access database, cache,&mldr;</p></li><li><p>create service for each job</p></li><li><p>access to service depends on where the job is run</p><ul><li>in container: connect via docker network ⇒ <em>simple</em></li><li>on host: map docker port to container port</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Redis Service Example</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>: <span style=color:#ae81ff>push</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Label of the container job</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runner-job</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># You must use a Linux environment when using service containers or container jobs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Service containers to run with `runner-job`</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Label used to access the service container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Docker Hub image</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># Opens tcp port 6379 on the host and service container</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>6379</span>:<span style=color:#ae81ff>6379</span>
</span></span></code></pre></div></li></ul></li><li><p><em>circleci</em> vs <em>github</em>:</p><ul><li>github both support container and runner</li><li>circleci has para test grouping (github does not)</li></ul></li><li><p>two types of action</p><ul><li>Docker</li><li>Javascript<ul><li>simplifies action code</li><li>faster than Docker container</li></ul></li></ul></li><li><p><strong>security</strong> with public repo on self-hosted runner</p><ul><li>people can create PR and run code on the runner</li></ul></li><li><p>location of action</p><ul><li>if develop for other people ⇒ keep in its own repo<ul><li>decouple action version from app code version</li></ul></li><li>otherwise, <code>.github</code></li></ul></li><li><p>run action in Docker container</p><ul><li>github action&rsquo;s metadata file can override some Dockerfile instructions</li><li><code>USER</code>: must be default (<code>root</code>)</li><li><code>WORK_DIR</code>: github set workdir in <code>GITHUB_WORKSPACE</code> and mount</li><li>Using the example Dockerfile above, GitHub will send the args configured in the action&rsquo;s metadata file as arguments to <a href=http://entrypoint.sh/>entrypoint.sh</a></li></ul></li><li><p>monitoring</p><ul><li>log at <code>_diag</code> directory</li><li>journalctl log (service named with specific format)</li></ul></li></ul><p>note <code>deploy keys</code></p><p>10/05/2020</p><p>[k8s] statefulset</p><p>headless service</p><ul><li>pod of stateless application is same ⇒ can expose using <code>ClusterIP</code></li><li>Stateful services (Kafka, db) is not<ul><li>each instance do its own job</li><li>each instance in cluster has stable unique identity</li></ul></li></ul><p>PV and PVC</p><ul><li>separate to abstract: how the volume is provision VS how to &ldquo;use&rdquo; the volume</li><li><code>PV</code>: lo level of representation of storage</li></ul><p>06/07/2020</p><p><strong>[exp]</strong> ca cert problem</p><ol><li>run <code>curl-config --ca</code> and you will get something, e.g. <code>/etc/ssl/certs/ca-certificates.crt</code>, back it up(in case you need it)</li><li>go to <a href=https://curl.haxx.se/docs/caextract.html>caExtract.html</a> download the latest <code>cacert.pem</code>, e.g. <code>cacert-2017-01-18.pem</code></li><li>replace the original &lsquo;ca-certificates.crt&rsquo; with the latest <code>cacert.pem</code> , e.g. <code>sudo mv cacert-2017-01-18.pem /etc/ssl/certs/ca-certificates.crt</code></li><li>try to <code>yaourt -S tor-browser-en</code> again</li></ol><p>ref:<a href="https://bbs.archlinux.org/viewtopic.php?id=186138">[SOLVED] /etc/pki/tls/certs/ca-bundle.crt not present</a></p><p>07/07/2020</p><p>load avg. vs CPU utilization</p><ul><li><code>load avg.</code>:<ul><li>how many tasks are in kernel waiting queue or running</li><li>not just CPU, also Disk (I/O)</li><li><em>short-lived tasks can be missed</em></li><li>not divided by # of cores</li><li><blockquote><blockquote><p>5 / core ⇒ HIGH</p></blockquote></blockquote></li></ul></li><li><code>CPU utilization</code><ul><li>how busy CPU are</li></ul></li><li>high load avg. / low cpu utilization:<ul><li>Lot of IO data stuck in <code>WAIT</code></li><li><strong>storage issue</strong></li></ul></li></ul><p>15/07/2020</p><p>Building container best practice</p><ul><li>pid 1 (zombie, orphan proc)<ul><li>proper signal handlers for app</li><li>if use script for bootstrap ⇒ <code>exec</code> to replace pid</li><li>use specialized init system<ul><li><code>tini</code>: minimal for container env (signal handler, reap zombie proc,..)<ul><li>run <code>docker --init</code></li><li>install as entry point if use k8s</li></ul></li></ul></li><li>enable share process namespace (k8s) - in same pod<ul><li>share file system</li><li>proc is visible from other container</li><li><em>use</em> for special case: sidecar for log,&mldr;</li></ul></li></ul></li><li>minimal size<ul><li>do not install and remove in diff steps (overlay mechanism)</li></ul></li><li>sec<ul><li>disable run-as-root</li><li>enable read-only mode for fs</li></ul></li><li><strong>inject</strong> built files to other image<ul><li>build ⇒ copy from build image ⇒ <code>scratch</code> image</li></ul></li></ul><p>08/06/2020</p><p><strong>Linux command to view proc using port</strong></p><ul><li><code>lsof -i :[PORT]</code>: show proc <em>both</em> listening and established on port</li><li><code>ss</code><ul><li>show proc with detailed info</li><li>have intuitive filters<ul><li><code>ss -lptn 'dport = :443'</code></li></ul></li></ul></li><li><code>nestat -nalpt</code></li></ul><p>02/02/2021</p><ul><li>IaC is same with application code<ul><li>have entropy, maintenance burden,&mldr;</li><li>keep thing simple</li></ul></li></ul><p>19/02/2021</p><p>EFK setup:</p><ul><li>if you modify any <code>xpack.*</code> setting in kibana<ul><li>the perf optimization will run → can hang</li></ul></li><li>to enable xpack without ssl:<ul><li>setup ES in single-node mode</li></ul></li><li>use configmap to put config<ul><li>not env var</li></ul></li></ul><p>20/02/2021</p><p>Kubernetes liveness vs readiness</p><ul><li>liveness:<ul><li>to determine when a pod need to be restarted</li><li>keep beating intervally</li></ul></li><li>readiness:<ul><li>to determine use a pod as backend of a service</li><li>if not ready → remove from service load balancer</li></ul></li></ul><p><a href=https://www.notion.so/Sharing-Docker-101-0272f2850ae840c5ab9ee1edd73b5251>Sharing - Docker 101’</a></p><p><a href=https://www.notion.so/ES-6e708e196b5149e1be7badb962f42308>ES</a></p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://cookiehanhoan.github.io/images/rice.svg alt=Logo><h1 class=about__title>CHHCyberBlog</h1><p class=about__description>Blog về bảo mật - Cookie Han Hoan</p></div><ul class=aside__social-links><li><a href=https://www.facebook.com/cookie.han.hoan/ rel=me aria-label=Facebook title=Facebook><i class="fa-brands fa-facebook" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://github.com/cookiehanhoan rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:hazy@cookiehanhoan.org rel=me aria-label=Email title=Email><i class="fa-solid fa-envelope" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>My random cookies</p><p>By Phong Vu</p></div></section><footer class=page__footer><p></p><br><br><p class=copyright></p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>